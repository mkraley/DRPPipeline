# DRPPipeline - Development Guidelines

# ⚠️ MANDATORY CHECKLIST - Review Before EVERY Response

When modifying or creating code, you MUST:
- [ ] Update or create corresponding unit tests in test_xxx.py
- [ ] Add type hints to all function signatures  
- [ ] Add docstrings to all functions and classes
- [ ] Keep methods short (one responsibility each)
- [ ] Check for code duplication and apply DRY
- [ ] Prepare git commit with all changed files and message
- [ ] Use UTF-8-sig encoding for CSV/text files
- [ ] Use Windows path syntax (backslashes, drive letters)

**If ANY of these are missing, the response is incomplete.**

---

## Testing - NON-NEGOTIABLE

**EVERY code change MUST include corresponding test updates**
- Tests in a sub folder of the implementation files: `module.py` → `tests/test_module.py`
- Modifying existing code → update existing tests
- Adding new code → write new tests  
- No code submission is complete without tests
- Run all tests - all tests should pass. Fix any that do not pass.

---

## Source Control - REQUIRED AT END OF EVERY RESPONSE

At the end of EVERY response that modifies code, provide:
```bash
git add <list all changed files>
git commit -m "Summary description of changes"
```

Example:
```bash
git add src/scraper.py src/utils.py test_scraper.py
git commit -m "Add retry logic with exponential backoff"
```

---

## Code Organization - ENFORCE STRICTLY

- **One class per file** (filename matches class name in snake_case)
- **Methods must be short** - one responsibility each
  - If you describe a method with "and", split it into two methods
  - Target: under 50 lines per method
- **DRY (Don't Repeat Yourself)**
  - Before writing code, search for similar existing code
  - Extract duplicate logic into shared utility functions
  - Place utilities in appropriate modules (e.g., utils/)
- **File size**: Keep files under ~200 lines; split if longer
- Use classes and inheritance where appropriate
- Segregate related functionality into separate modules

---

## Code Style & Conventions

**Environment:**
- Python 3.13
- Target: Windows 11
- Use Playwright for web automation

**Coding Standards:**
- Type hints on all function parameters and returns
- Docstrings for all public functions and classes
- Descriptive variable names (no single letters except loop counters)
- UTF-8-sig encoding for CSV and text files
- Windows path syntax: backslashes, drive letters (e.g., `C:\path\to\file`)

---

## Error Handling

- Provide clear, contextual error messages
- Use try/except for file operations and network requests
- Log errors appropriately but don't crash unless fatal
- Validate inputs before processing (URLs, file paths, etc.)
- Missing CSV/Excel columns should halt execution

---

## Logging

Use standard log levels appropriately:
- `debug`: Detailed verbose diagnostic information
- `info`: General informational messages
- `warning`: Warning messages for recoverable issues
- `error`: Error messages for serious problems - abort the current operation, but continue with the batch
- `exception`: Fatal error - cease execution

---

## Configuration

- Use command-line arguments with sensible defaults (typer)
- Support config file for parameters
- Command-line args override config file values
- Document all configuration options

---

## Database

- Use SQLite with WAL mode for concurrent access
- Place database utilities in shared_db.py

---

## Debugging

- Store temporary debug files and outputs in `debug/` folder
- Don't clutter the main project directory

---

## Documentation

- Update README.md when adding features or changing behavior
- Include usage examples in docstrings
- Keep requirements.txt synchronized with dependencies

---

## Anti-Patterns - NEVER DO THESE

❌ Submitting code without tests
❌ Methods longer than 50 lines  
❌ Copy-pasting similar code (use shared functions)
❌ Missing type hints or docstrings
❌ Skipping git commit preparation
❌ Mixing multiple responsibilities in one method/class

